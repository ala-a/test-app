<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project Cards</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    body { 
      background: linear-gradient(to bottom, #f8fafc, #ffffff); 
    }
  </style>
</head>
<body class="min-h-screen text-slate-800">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    
    const STAGES = {
      idea: { label: "Idea", color: "bg-slate-600" },
      in_progress: { label: "In Progress", color: "bg-blue-600" },
      blocked: { label: "Blocked", color: "bg-rose-600" },
      done: { label: "Done", color: "bg-emerald-600" },
    };

    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

    const loadProjects = () => {
      try {
        if (typeof Storage !== "undefined") {
          const raw = localStorage.getItem("project-cards-data");
          return raw ? JSON.parse(raw) : [];
        }
      } catch (e) {
        console.log("Storage not available, using memory only");
      }
      return [];
    };

    const saveProjects = (projects) => {
      try {
        if (typeof Storage !== "undefined") {
          localStorage.setItem("project-cards-data", JSON.stringify(projects));
        }
      } catch (e) {
        console.log("Cannot save to storage");
      }
    };

    const timeAgo = (timestamp) => {
      const seconds = Math.floor((Date.now() - timestamp) / 1000);
      if (seconds < 60) return seconds + "s ago";
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return minutes + "m ago";
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return hours + "h ago";
      const days = Math.floor(hours / 24);
      if (days < 7) return days + "d ago";
      const weeks = Math.floor(days / 7);
      if (weeks < 4) return weeks + "w ago";
      const months = Math.floor(days / 30);
      return months + "mo ago";
    };

    const stageHelperText = (key) => ({
      idea: "Just getting started",
      in_progress: "Actively working on it",
      blocked: "Needs something before moving",
      done: "All set",
    }[key] || "");

    function App() {
      const [projects, setProjects] = useState([]);
      const [titleInput, setTitleInput] = useState("");
      const [search, setSearch] = useState("");
      const [selected, setSelected] = useState(null);

      useEffect(() => {
        setProjects(loadProjects());
      }, []);

      useEffect(() => {
        saveProjects(projects);
      }, [projects]);

      const filtered = useMemo(() => {
        if (!search.trim()) return projects;
        const query = search.toLowerCase();
        return projects.filter(p => 
          p.title.toLowerCase().includes(query) || 
          p.nextSteps.toLowerCase().includes(query)
        );
      }, [projects, search]);

      const addProject = (e) => {
        e && e.preventDefault();
        const name = titleInput.trim();
        if (!name) return;
        const now = Date.now();
        setProjects([{
          id: uid(),
          title: name,
          stage: "idea",
          nextSteps: "",
          createdAt: now,
          updatedAt: now
        }, ...projects]);
        setTitleInput("");
      };

      const updateProject = (id, updates) => {
        setProjects(prev => prev.map(p => 
          p.id === id ? { ...p, ...updates, updatedAt: Date.now() } : p
        ));
      };

      const removeProject = (id) => {
        setProjects(prev => prev.filter(p => p.id !== id));
        if (selected && selected.id === id) setSelected(null);
      };

      return (
        <div className="min-h-screen">
          <header className="sticky top-0 z-10 backdrop-blur bg-white/70 border-b border-slate-200">
            <div className="mx-auto max-w-5xl px-4 py-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
              <h1 className="text-2xl sm:text-3xl font-bold tracking-tight">Project Cards</h1>
              <div className="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                <form onSubmit={addProject} className="flex w-full sm:w-auto gap-2">
                  <input 
                    className="flex-1 sm:w-80 rounded-2xl border border-slate-300 bg-white px-4 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Add a project name…"
                    value={titleInput}
                    onChange={e => setTitleInput(e.target.value)}
                  />
                  <button 
                    type="submit"
                    className="rounded-2xl px-4 py-2 bg-blue-600 text-white font-medium shadow hover:bg-blue-700 active:scale-[.98]"
                  >
                    Add
                  </button>
                </form>
                <input 
                  className="rounded-2xl border border-slate-300 bg-white px-4 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="Search projects…"
                  value={search}
                  onChange={e => setSearch(e.target.value)}
                />
              </div>
            </div>
          </header>

          <main className="mx-auto max-w-5xl px-4 pb-24 pt-6">
            {projects.length === 0 ? (
              <EmptyState onAddDemo={() => setProjects(demoData())} />
            ) : (
              <>
                <div className="mb-3 flex items-center justify-between">
                  <p className="text-sm text-slate-500">
                    {filtered.length} project{filtered.length === 1 ? "" : "s"}
                  </p>
                  <button 
                    onClick={() => {
                      if (confirm("Delete ALL projects? This cannot be undone.")) {
                        setProjects([]);
                      }
                    }}
                    className="text-sm text-rose-600 hover:underline"
                  >
                    Clear all
                  </button>
                </div>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                  {filtered.map(project => (
                    <ProjectCard
                      key={project.id}
                      project={project}
                      onOpen={() => setSelected(project)}
                      onDelete={() => removeProject(project.id)}
                    />
                  ))}
                </div>
              </>
            )}
          </main>

          <EditPanel
            project={selected}
            onClose={() => setSelected(null)}
            onChange={updates => selected && updateProject(selected.id, updates)}
          />
        </div>
      );
    }

    function ProjectCard({ project, onOpen, onDelete }) {
      const stage = STAGES[project.stage];
      return (
        <div className="group relative rounded-2xl border border-slate-200 bg-white p-4 shadow-sm hover:shadow-md transition-shadow">
          <div className="flex items-start gap-3">
            <div className={"h-2 w-2 mt-2 rounded-full " + stage.color} />
            <div className="flex-1 min-w-0">
              <h3 className="font-semibold truncate pr-8">{project.title}</h3>
              <div className="mt-1 flex flex-wrap items-center gap-2 text-xs text-slate-500">
                <span className={"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-white " + stage.color}>
                  {stage.label}
                </span>
                <span>Updated {timeAgo(project.updatedAt)}</span>
              </div>
              {project.nextSteps ? (
                <p className="mt-3 line-clamp-3 text-sm text-slate-700 whitespace-pre-wrap">
                  {project.nextSteps}
                </p>
              ) : (
                <p className="mt-3 text-sm italic text-slate-400">No notes yet</p>
              )}
            </div>
          </div>
          <div className="mt-4 flex items-center justify-between">
            <button 
              onClick={onOpen}
              className="rounded-xl bg-slate-900 text-white px-3 py-1.5 text-sm font-medium shadow hover:bg-slate-800"
            >
              Open
            </button>
            <button 
              onClick={() => {
                if (confirm("Delete this project?")) onDelete();
              }}
              className="rounded-xl px-3 py-1.5 text-sm font-medium text-rose-600 hover:bg-rose-50"
            >
              Delete
            </button>
          </div>
        </div>
      );
    }

    function EditPanel({ project, onClose, onChange }) {
      const [local, setLocal] = React.useState(project);
      
      React.useEffect(() => {
        setLocal(project);
      }, [project]);

      if (!project || !local) return null;

      const stageKeys = Object.keys(STAGES);

      return (
        <div className="fixed inset-0 z-50">
          <div className="absolute inset-0 bg-black/40" onClick={onClose} />
          <div className="absolute right-0 top-0 h-full w-full sm:w-[520px] bg-white shadow-2xl transform transition-transform">
            <div className="flex items-center justify-between border-b border-slate-200 p-4">
              <h2 className="text-lg font-semibold">Edit Project</h2>
              <button 
                onClick={onClose}
                className="rounded-full px-3 py-1 text-slate-600 hover:bg-slate-100"
              >
                Close
              </button>
            </div>
            <div className="p-4 space-y-4 overflow-y-auto h-[calc(100%-56px)]">
              <div>
                <label className="text-xs text-slate-500">Project name</label>
                <input 
                  className="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value={local.title}
                  onChange={e => setLocal({ ...local, title: e.target.value })}
                  onBlur={() => onChange({ title: local.title })}
                />
              </div>
              <div>
                <label className="text-xs text-slate-500">Stage</label>
                <div className="mt-1 grid grid-cols-2 gap-2">
                  {stageKeys.map(key => (
                    <button 
                      key={key}
                      onClick={() => {
                        setLocal({ ...local, stage: key });
                        onChange({ stage: key });
                      }}
                      className={"rounded-xl px-3 py-2 text-left border " + 
                        (local.stage === key 
                          ? "border-slate-900 bg-slate-900 text-white" 
                          : "border-slate-300 hover:bg-slate-50")}
                    >
                      <div className="font-medium">{STAGES[key].label}</div>
                      <div className="text-xs opacity-70">{stageHelperText(key)}</div>
                    </button>
                  ))}
                </div>
              </div>
              <div>
                <label className="text-xs text-slate-500">Next steps / Notes</label>
                <textarea 
                  className="mt-1 w-full min-h-[160px] rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  placeholder="What should happen next?"
                  value={local.nextSteps}
                  onChange={e => setLocal({ ...local, nextSteps: e.target.value })}
                  onBlur={() => onChange({ nextSteps: local.nextSteps })}
                />
              </div>
              <div className="text-xs text-slate-500">
                <div>Created {new Date(project.createdAt).toLocaleString()}</div>
                <div>Last updated {new Date(project.updatedAt).toLocaleString()}</div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function EmptyState({ onAddDemo }) {
      return (
        <div className="mx-auto max-w-xl rounded-3xl border border-dashed border-slate-300 p-8 text-center bg-white">
          <h2 className="text-xl font-semibold">Let's make your first project</h2>
          <p className="mt-2 text-slate-600">
            Use the box above to add a project by name. It appears as a card. Click the card to add next steps and a stage.
          </p>
          <button 
            onClick={onAddDemo}
            className="mt-6 rounded-2xl px-4 py-2 bg-slate-900 text-white font-medium shadow hover:bg-slate-800"
          >
            Add example projects
          </button>
        </div>
      );
    }

    function demoData() {
      const now = Date.now();
      return [
        {
          id: uid(),
          title: "Plan website refresh",
          stage: "in_progress",
          nextSteps: "Draft sitemap\nCollect brand colors\nPick a template",
          createdAt: now - 1000 * 60 * 60 * 24 * 3,
          updatedAt: now - 1000 * 60 * 60 * 2
        },
        {
          id: uid(),
          title: "Buy a new bike",
          stage: "idea",
          nextSteps: "Research models\nSet a budget",
          createdAt: now - 1000 * 60 * 60 * 24 * 6,
          updatedAt: now - 1000 * 60 * 60 * 24
        },
        {
          id: uid(),
          title: "Spring cleaning",
          stage: "blocked",
          nextSteps: "Get storage bins\nSchedule a Saturday",
          createdAt: now - 1000 * 60 * 60 * 24 * 8,
          updatedAt: now - 1000 * 60 * 60 * 24 * 7
        }
      ];
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
